<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.33">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/konviw/images/konviw.png"><meta property="og:image" content="/konviw/images/konviw.svg"><meta property="og:title" content="konviw"><meta property="og:description" content="Enterprise public viewer for your Confluence pages."><meta property="og:url" content="https://sanofi-iadc.github.io/konviw/"><meta property="og:site_name" content="konviw"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@jhgascon"><meta name="twitter:title" content="konviw"><meta name="twitter:description" content="Enterprise public viewer for your Confluence pages."><meta name="twitter:creator" content="@jhgascon"><meta name="twitter:image" content="/konviw/images/konviw.svg"><title>Testing | konviw</title><meta name="description" content="Enterprise public viewer for your Confluence pages.">
    <link rel="modulepreload" href="/konviw/assets/app.89ae94f5.js"><link rel="modulepreload" href="/konviw/assets/testing.html.0bbbf48d.js"><link rel="modulepreload" href="/konviw/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/konviw/assets/testing.html.34067b44.js">
    <link rel="stylesheet" href="/konviw/assets/style.71b74bdf.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/konviw/" class=""><img class="logo" src="/konviw/images/konviw.svg" alt="konviw"><span class="site-name can-hide">konviw</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/konviw/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/konviw/introduction" class="" aria-label="Documentation"><!--[--><!--]--> Documentation <!--[--><!--]--></a></div><div class="navbar-item"><a href="/konviw/demoIntroduction" class="" aria-label="Demo"><!--[--><!--]--> Demo <!--[--><!--]--></a></div><div class="navbar-item"><a href="/konviw/about" class="" aria-label="About"><!--[--><!--]--> About <!--[--><!--]--></a></div><div class="navbar-item"><a href="/konviw/changelog" class="" aria-label="Changelog"><!--[--><!--]--> Changelog <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://konviw.vercel.app/cpv/oas3" rel="noopener noreferrer" target="_blank" aria-label="API"><!--[--><!--]--> API <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/Sanofi-IADC/konviw" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/konviw/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/konviw/introduction" class="" aria-label="Documentation"><!--[--><!--]--> Documentation <!--[--><!--]--></a></div><div class="navbar-item"><a href="/konviw/demoIntroduction" class="" aria-label="Demo"><!--[--><!--]--> Demo <!--[--><!--]--></a></div><div class="navbar-item"><a href="/konviw/about" class="" aria-label="About"><!--[--><!--]--> About <!--[--><!--]--></a></div><div class="navbar-item"><a href="/konviw/changelog" class="" aria-label="Changelog"><!--[--><!--]--> Changelog <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://konviw.vercel.app/cpv/oas3" rel="noopener noreferrer" target="_blank" aria-label="API"><!--[--><!--]--> API <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/Sanofi-IADC/konviw" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/konviw/introduction.html" class="sidebar-item sidebar-heading" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----></li><li><a href="/konviw/installation.html" class="sidebar-item sidebar-heading" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/konviw/testing.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Testing"><!--[--><!--]--> Testing <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/konviw/testing.html#unit-tests-with-jest" class="router-link-active router-link-exact-active sidebar-item" aria-label="Unit Tests with Jest"><!--[--><!--]--> Unit Tests with Jest <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/konviw/testing.html#e2e-visual-tests-with-cypress" class="router-link-active router-link-exact-active sidebar-item" aria-label="E2E Visual Tests with Cypress"><!--[--><!--]--> E2E Visual Tests with Cypress <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/konviw/architecture.html" class="sidebar-item sidebar-heading" aria-label="Architecture"><!--[--><!--]--> Architecture <!--[--><!--]--></a><!----></li><li><a href="/konviw/performance.html" class="sidebar-item sidebar-heading" aria-label="Performance"><!--[--><!--]--> Performance <!--[--><!--]--></a><!----></li><li><a href="/konviw/usage.html" class="sidebar-item sidebar-heading" aria-label="Usage"><!--[--><!--]--> Usage <!--[--><!--]--></a><!----></li><li><p class="sidebar-item sidebar-heading collapsible">Demo <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/konviw/demoIntroduction.html" class="sidebar-item" aria-label="Demo with Title"><!--[--><!--]--> Demo with Title <!--[--><!--]--></a><!----></li><li><a href="/konviw/demoNoTitle.html" class="sidebar-item" aria-label="Demo without Title"><!--[--><!--]--> Demo without Title <!--[--><!--]--></a><!----></li><li><a href="/konviw/demoStyles.html" class="sidebar-item" aria-label="Demo Styles"><!--[--><!--]--> Demo Styles <!--[--><!--]--></a><!----></li><li><a href="/konviw/demoComments.html" class="sidebar-item" aria-label="Demo Comments"><!--[--><!--]--> Demo Comments <!--[--><!--]--></a><!----></li><li><a href="/konviw/demoBlogPost.html" class="sidebar-item" aria-label="Demo with Blog Post"><!--[--><!--]--> Demo with Blog Post <!--[--><!--]--></a><!----></li><li><a href="/konviw/demoSlidesDocs.html" class="sidebar-item" aria-label="How to create Konviw Slides"><!--[--><!--]--> How to create Konviw Slides <!--[--><!--]--></a><!----></li><li><a href="/konviw/demoJira.html" class="sidebar-item" aria-label="Demo Jira Macro"><!--[--><!--]--> Demo Jira Macro <!--[--><!--]--></a><!----></li><li><a href="/konviw/demoMultiFrame.html" class="sidebar-item" aria-label="Demo multi iframe in a page"><!--[--><!--]--> Demo multi iframe in a page <!--[--><!--]--></a><!----></li><li><a href="/konviw/demoCharts.html" class="sidebar-item" aria-label="Demo Chart Macro"><!--[--><!--]--> Demo Chart Macro <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/konviw/about.html" class="sidebar-item sidebar-heading" aria-label="About"><!--[--><!--]--> About <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="unit-tests-with-jest" tabindex="-1"><a class="header-anchor" href="#unit-tests-with-jest" aria-hidden="true">#</a> Unit Tests with Jest</h2><h3 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h3><p>We use <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer"><strong>Jest</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> to implement our unit tests. We will show you our unit testing <strong>strategy</strong> for testing the <strong>Steps</strong>, with an example.</p><p><strong>Reminder:</strong> Unit tests are developers oriented tests. Their purposes are:</p><ul><li>To let developers add new functionnalities without breaking something</li><li>To make good documentation of what a component should do</li><li>Ensure that an isolated component is working as expected</li><li>Ensure the code is maintenable and well written (a bad code is difficult to test)</li></ul><h3 id="strategy" tabindex="-1"><a class="header-anchor" href="#strategy" aria-hidden="true">#</a> Strategy</h3><p>A classic unit test is done this way:</p><ol><li>Set up a context</li><li>Set the expected result for the context</li><li>Execute the piece of code we want to test on the context</li><li>Check if the result is the expected</li></ol><p>Example with a function:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">multiplication</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">a</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>First set the context</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Then the expected result</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> expectedResult <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// according to the context</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Finally, call the function and check the result</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">multiplication</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>expectedResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This is <strong>straightforward</strong>, and actually this kind of strategy is enough for testing <strong>90%</strong> of your code. If not, maybe you should refactor/review your code. If you are not able to easily unit test a component, very often it&#39;s because the component does too many things (<strong>SOLID principle</strong>), or it does it in a too much complex way.</p><hr><p>We will do the same for testing our <strong>Steps</strong>:</p><ol><li>Make a html code with minimal useful content for the step (set up the context)</li><li>Make a html code we expect to the Step to produce (the expected result)</li><li>Finally, execute the Step on our context and check the result</li></ol><h3 id="example" tabindex="-1"><a class="header-anchor" href="#example" aria-hidden="true">#</a> Example</h3><p>Consider the following Step:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Step <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>context<span class="token operator">:</span> ContextService<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> $ <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getCheerioBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#39;#Content&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1 class=&quot;titlePage&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>context<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h1&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>This Step put a heading tag <em>h1</em> at the top of the html page with the title of the page context. So let&#39;s test it:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 1. Set up the context: Minimal html code needed</span>
<span class="token keyword">const</span> example <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;html&gt;
  &lt;head&gt;&lt;/head&gt;
  &lt;body&gt;
      &lt;div id=&quot;Content&quot;&gt;
        &lt;p&gt;Test !&lt;/p&gt;
      &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;addHeaderTitle&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context<span class="token operator">:</span> ContextService<span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> moduleRef <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createModuleRefForStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context <span class="token operator">=</span> moduleRef<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>ContextService<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>ContextService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    context<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token string">&#39;XXX&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;dark&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should add the h1 title&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> step <span class="token operator">=</span> <span class="token function">addHeaderTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1. Set up the context: Set the ContextService config</span>
    <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token string">&#39;I am the Title&#39;</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">setHtmlBody</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. Set the expected result</span>
    <span class="token keyword">const</span> expectedResult <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1 class=&quot;titlePage&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h1&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token comment">// 3. Execute the code to test</span>
    <span class="token function">step</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. Make the assertion</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getHtmlBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span>expectedResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>And that&#39;s it 😉.</p><h2 id="e2e-visual-tests-with-cypress" tabindex="-1"><a class="header-anchor" href="#e2e-visual-tests-with-cypress" aria-hidden="true">#</a> E2E Visual Tests with Cypress</h2><h3 id="introduction-1" tabindex="-1"><a class="header-anchor" href="#introduction-1" aria-hidden="true">#</a> Introduction</h3><p>We use <a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer"><strong>Cypress</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> and the plugin <a href="https://github.com/meinaart/cypress-plugin-snapshots" target="_blank" rel="noopener noreferrer"><strong>cypress-plugin-snapshots</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> to implement our end-to-end visual tests. We will see here our visual testing <strong>strategy</strong> for testing the confluence <strong>pages</strong> through a running version of Konviw, with an example.</p><h3 id="strategy-1" tabindex="-1"><a class="header-anchor" href="#strategy-1" aria-hidden="true">#</a> Strategy</h3><p>E2E Visual Tests consists of taking snapshots of each pages the first time you run the tests, then you need to add and commit the generated snapshots to git. Then each time a Pull Request is created or a PR is merged in master, github will trigger the Cypress Tests workflow which run the cypress tests against the running version of konviw on vercel: https://konviw.vercel.app/cpv.</p><p>Cypress will compare each commited snapshots with the running konviw pages on vercel and will fail in case the snapshot doesn&#39;t match the live page.</p><h3 id="example-1" tabindex="-1"><a class="header-anchor" href="#example-1" aria-hidden="true">#</a> Example</h3><ol><li>Create your confluence page for visual testing and get the ID of the page</li><li>Create your test in <code>tests/e2e/cypress/integration/[YOUR_TEST].spec.ts</code></li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span>

<span class="token function">context</span><span class="token punctuation">(</span><span class="token string">&#39;Example&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;match the whole page&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>
      <span class="token string">&#39;/wiki/spaces/KONVIW/pages/[PAGE_ID]/Example&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      cy<span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchImageSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="3"><li>Run the tests with cypress</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># In order to run the tests against an URL, you will need to execute this command with the correct URL for CYPRESS_BASE_URL</span>
<span class="token comment"># By default it will take the URL specified in cypress.json</span>
<span class="token assign-left variable">CYPRESS_BASE_URL</span><span class="token operator">=</span>https://konviw.vercel.app/cpv <span class="token function">npm</span> run cypress:run
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>You can also run the GUI version:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">CYPRESS_BASE_URL</span><span class="token operator">=</span>https://konviw.vercel.app/cpv <span class="token function">npm</span> run cypress:open
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>It will generate any new snapshot for new tests you&#39;ve added.</p><ol start="4"><li>Add these snapshots to git, commit and push your tests</li></ol><h3 id="update-snapshots" tabindex="-1"><a class="header-anchor" href="#update-snapshots" aria-hidden="true">#</a> Update snapshots</h3><p>In case you&#39;ve added some changes which break an existing test, you need to delete the snapshot and re-run the tests to update the snapshot:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 1. Delete the snapshot</span>
<span class="token function">rm</span> -f tests/e2e/cypress/integration/__image_snapshots__/Example.png

<span class="token comment"># 2. Re-run the test</span>
<span class="token assign-left variable">CYPRESS_BASE_URL</span><span class="token operator">=</span>https://konviw.vercel.app/cpv <span class="token function">npm</span> run cypress:run

<span class="token comment"># 3. Add, commit &amp; push</span>
<span class="token function">git</span> <span class="token function">add</span> tests/e2e/cypress/integration/__image_snapshots__/Example.png
<span class="token function">git</span> commit -m <span class="token string">&quot;fix: test&quot;</span>
<span class="token function">git</span> push
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: semantic-release-bot@martynus.net">semantic-release-bot</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/konviw/installation.html" class="" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a></span><span class="next"><a href="/konviw/architecture.html" class="" aria-label="Architecture"><!--[--><!--]--> Architecture <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/konviw/assets/app.89ae94f5.js" defer></script>
  </body>
</html>
